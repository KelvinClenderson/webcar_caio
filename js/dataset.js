// js/dataset.js

// Placeholder (troque por um asset local se preferir)
const FALLBACK_IMAGE =
  'https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/800px-No_image_available.svg.png';

// Busca thumbnail do Wikipedia REST (retorna URL direta do Wikimedia)
async function getWikiThumb(wikiTitle) {
  const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(wikiTitle)}`;

  try {
    const res = await fetch(url, {
      headers: { accept: 'application/json' },
    });

    if (!res.ok) return null;

    const data = await res.json();
    // thumbnail.source costuma ser uma URL direta e estável do upload.wikimedia.org
    return data?.thumbnail?.source || null;
  } catch {
    return null;
  }
}

// Preenche car.image garantindo URL existente (com fallback)
async function hydrateCarImages(cars) {
  // cache simples p/ não repetir requests se tiver títulos repetidos
  const cache = new Map();

  await Promise.all(
    cars.map(async (car) => {
      if (!car.wikiTitle) return;

      if (cache.has(car.wikiTitle)) {
        car.image = cache.get(car.wikiTitle) || FALLBACK_IMAGE;
        return;
      }

      const thumb = await getWikiThumb(car.wikiTitle);
      cache.set(car.wikiTitle, thumb);
      car.image = thumb || FALLBACK_IMAGE;
    }),
  );

  return cars;
}

// Lista curada de 50 carros únicos (imagens agora são resolvidas via Wikipedia)
const carDatabase = [
  // --- ESPORTIVOS ---
  {
    id: 1,
    make: 'Porsche',
    model: '911 Carrera S',
    year: 2024,
    price: 'R$ 1.250.000',
    engine: '3.0L Boxer',
    transmission: 'PDK 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Porsche_911',
    image: FALLBACK_IMAGE,
  },
  {
    id: 2,
    make: 'Audi',
    model: 'R8 V10',
    year: 2023,
    price: 'R$ 1.650.000',
    engine: '5.2L V10',
    transmission: 'S-Tronic',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Audi_R8',
    image: FALLBACK_IMAGE,
  },
  {
    id: 3,
    make: 'Nissan',
    model: 'GT-R Nismo',
    year: 2022,
    price: 'R$ 1.500.000',
    engine: '3.8L V6',
    transmission: 'Auto 6',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Nissan_GT-R',
    image: FALLBACK_IMAGE,
  },
  {
    id: 4,
    make: 'Lamborghini',
    model: 'Huracán EVO',
    year: 2023,
    price: 'R$ 3.800.000',
    engine: '5.2L V10',
    transmission: 'LDF 7',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Lamborghini_Huracan',
    image: FALLBACK_IMAGE,
  },
  {
    id: 5,
    make: 'Chevrolet',
    model: 'Corvette C8',
    year: 2024,
    price: 'R$ 1.100.000',
    engine: '6.2L V8',
    transmission: 'DCT 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Chevrolet_Corvette_(C8)',
    image: FALLBACK_IMAGE,
  },
  {
    id: 6,
    make: 'Toyota',
    model: 'Supra GR',
    year: 2024,
    price: 'R$ 550.000',
    engine: '3.0L Turbo',
    transmission: 'Auto 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Toyota_Supra',
    image: FALLBACK_IMAGE,
  },
  {
    id: 7,
    make: 'McLaren',
    model: '720S',
    year: 2023,
    price: 'R$ 4.200.000',
    engine: '4.0L V8',
    transmission: 'SSG 7',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'McLaren_720S',
    image: FALLBACK_IMAGE,
  },
  {
    id: 8,
    make: 'Ferrari',
    model: 'F8 Tributo',
    year: 2022,
    price: 'R$ 4.500.000',
    engine: '3.9L V8',
    transmission: 'F1 DCT',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Ferrari_F8_Tributo',
    image: FALLBACK_IMAGE,
  },
  {
    id: 9,
    make: 'Jaguar',
    model: 'F-Type R',
    year: 2023,
    price: 'R$ 890.000',
    engine: '5.0L V8',
    transmission: 'Auto 8',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Jaguar_F-Type',
    image: FALLBACK_IMAGE,
  },
  {
    id: 10,
    make: 'BMW',
    model: 'M8 Gran Coupe',
    year: 2024,
    price: 'R$ 1.300.000',
    engine: '4.4L V8',
    transmission: 'Auto 8',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'BMW_8_Series_(G15)',
    image: FALLBACK_IMAGE,
  },

  // --- SEDANS ---
  {
    id: 11,
    make: 'BMW',
    model: 'M3 Competition',
    year: 2024,
    price: 'R$ 850.000',
    engine: '3.0L I6',
    transmission: 'Auto 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'BMW_M3',
    image: FALLBACK_IMAGE,
  },
  {
    id: 12,
    make: 'Mercedes',
    model: 'C63 AMG',
    year: 2023,
    price: 'R$ 950.000',
    engine: '4.0L V8',
    transmission: 'Speedshift',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Mercedes-AMG_C63',
    image: FALLBACK_IMAGE,
  },
  {
    id: 13,
    make: 'Audi',
    model: 'RS7 Sportback',
    year: 2023,
    price: 'R$ 1.100.000',
    engine: '4.0L V8',
    transmission: 'Tiptronic',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Audi_RS7',
    image: FALLBACK_IMAGE,
  },
  {
    id: 14,
    make: 'Honda',
    model: 'Civic Touring',
    year: 2024,
    price: 'R$ 260.000',
    engine: '1.5L Turbo',
    transmission: 'CVT',
    drive: 'FWD',
    fuel: 'Híbrido',
    wikiTitle: 'Honda_Civic_(eleventh_generation)',
    image: FALLBACK_IMAGE,
  },
  {
    id: 15,
    make: 'Toyota',
    model: 'Corolla Altis',
    year: 2024,
    price: 'R$ 190.000',
    engine: '2.0L Hybrid',
    transmission: 'CVT',
    drive: 'FWD',
    fuel: 'Híbrido',
    wikiTitle: 'Toyota_Corolla_(E210)',
    image: FALLBACK_IMAGE,
  },
  {
    id: 16,
    make: 'Tesla',
    model: 'Model S Plaid',
    year: 2024,
    price: 'R$ 1.200.000',
    engine: 'Elétrico',
    transmission: 'Direct',
    drive: 'AWD',
    fuel: 'Elétrico',
    wikiTitle: 'Tesla_Model_S',
    image: FALLBACK_IMAGE,
  },
  {
    id: 17,
    make: 'Porsche',
    model: 'Taycan Turbo S',
    year: 2023,
    price: 'R$ 1.150.000',
    engine: 'Elétrico',
    transmission: '2-Speed',
    drive: 'AWD',
    fuel: 'Elétrico',
    wikiTitle: 'Porsche_Taycan',
    image: FALLBACK_IMAGE,
  },
  {
    id: 18,
    make: 'Bentley',
    model: 'Flying Spur',
    year: 2022,
    price: 'R$ 2.500.000',
    engine: '6.0L W12',
    transmission: 'Auto 8',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Bentley_Flying_Spur',
    image: FALLBACK_IMAGE,
  },
  {
    id: 19,
    make: 'Rolls-Royce',
    model: 'Ghost',
    year: 2023,
    price: 'R$ 4.800.000',
    engine: '6.75L V12',
    transmission: 'Auto 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Rolls-Royce_Ghost',
    image: FALLBACK_IMAGE,
  },
  {
    id: 20,
    make: 'Dodge',
    model: 'Charger Hellcat',
    year: 2022,
    price: 'R$ 800.000',
    engine: '6.2L V8 SC',
    transmission: 'Auto 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Dodge_Charger_(LDS)',
    image: FALLBACK_IMAGE,
  },

  // --- SUVs ---
  {
    id: 21,
    make: 'Land Rover',
    model: 'Range Rover',
    year: 2024,
    price: 'R$ 1.400.000',
    engine: '4.4L V8',
    transmission: 'Auto 8',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Range_Rover',
    image: FALLBACK_IMAGE,
  },
  {
    id: 22,
    make: 'Porsche',
    model: 'Cayenne GTS',
    year: 2023,
    price: 'R$ 980.000',
    engine: '4.0L V8',
    transmission: 'Tiptronic',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Porsche_Cayenne',
    image: FALLBACK_IMAGE,
  },
  {
    id: 23,
    make: 'Lamborghini',
    model: 'Urus',
    year: 2023,
    price: 'R$ 3.900.000',
    engine: '4.0L V8',
    transmission: 'Auto 8',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Lamborghini_Urus',
    image: FALLBACK_IMAGE,
  },
  {
    id: 24,
    make: 'Mercedes',
    model: 'G63 AMG',
    year: 2024,
    price: 'R$ 2.200.000',
    engine: '4.0L V8',
    transmission: 'Speedshift',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Mercedes-Benz_G-Class',
    image: FALLBACK_IMAGE,
  },
  {
    id: 25,
    make: 'Jeep',
    model: 'Wrangler Rubicon',
    year: 2023,
    price: 'R$ 480.000',
    engine: '2.0L Turbo',
    transmission: 'Auto 8',
    drive: '4WD',
    fuel: 'Gasolina',
    wikiTitle: 'Jeep_Wrangler',
    image: FALLBACK_IMAGE,
  },
  {
    id: 26,
    make: 'Volvo',
    model: 'XC90 Recharge',
    year: 2024,
    price: 'R$ 650.000',
    engine: '2.0L Híbrido',
    transmission: 'Auto 8',
    drive: 'AWD',
    fuel: 'Híbrido',
    wikiTitle: 'Volvo_XC90',
    image: FALLBACK_IMAGE,
  },
  {
    id: 27,
    make: 'BMW',
    model: 'X6 M',
    year: 2023,
    price: 'R$ 1.150.000',
    engine: '4.4L V8',
    transmission: 'Auto 8',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'BMW_X6',
    image: FALLBACK_IMAGE,
  },
  {
    id: 28,
    make: 'Audi',
    model: 'Q8',
    year: 2023,
    price: 'R$ 750.000',
    engine: '3.0L V6',
    transmission: 'Tiptronic',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Audi_Q8',
    image: FALLBACK_IMAGE,
  },
  {
    id: 29,
    make: 'Tesla',
    model: 'Model X',
    year: 2024,
    price: 'R$ 1.300.000',
    engine: 'Elétrico',
    transmission: 'Direct',
    drive: 'AWD',
    fuel: 'Elétrico',
    wikiTitle: 'Tesla_Model_X',
    image: FALLBACK_IMAGE,
  },
  {
    id: 30,
    make: 'Ford',
    model: 'Bronco Sport',
    year: 2023,
    price: 'R$ 290.000',
    engine: '2.0L Turbo',
    transmission: 'Auto 8',
    drive: '4WD',
    fuel: 'Gasolina',
    wikiTitle: 'Ford_Bronco_Sport',
    image: FALLBACK_IMAGE,
  },

  // --- MUSCLE & CLÁSSICOS MODERNOS ---
  {
    id: 31,
    make: 'Ford',
    model: 'Mustang Mach 1',
    year: 2023,
    price: 'R$ 590.000',
    engine: '5.0L V8',
    transmission: 'Auto 10',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Ford_Mustang',
    image: FALLBACK_IMAGE,
  },
  {
    id: 32,
    make: 'Chevrolet',
    model: 'Camaro SS',
    year: 2023,
    price: 'R$ 550.000',
    engine: '6.2L V8',
    transmission: 'Auto 10',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Chevrolet_Camaro',
    image: FALLBACK_IMAGE,
  },
  {
    id: 33,
    make: 'Dodge',
    model: 'Challenger SRT',
    year: 2022,
    price: 'R$ 850.000',
    engine: '6.2L V8',
    transmission: 'Auto 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Dodge_Challenger',
    image: FALLBACK_IMAGE,
  },
  {
    id: 34,
    make: 'Shelby',
    model: 'Cobra 427',
    year: 1965,
    price: 'R$ 5.000.000',
    engine: '7.0L V8',
    transmission: 'Manual 4',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'AC_Cobra',
    image: FALLBACK_IMAGE,
  },
  {
    id: 35,
    make: 'Ford',
    model: 'GT',
    year: 2022,
    price: 'R$ 8.000.000',
    engine: '3.5L V6 EcoBoost',
    transmission: 'DCT 7',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Ford_GT',
    image: FALLBACK_IMAGE,
  },

  // --- HATCHBACKS & OUTROS ---
  {
    id: 36,
    make: 'Volkswagen',
    model: 'Golf GTI',
    year: 2023,
    price: 'R$ 350.000',
    engine: '2.0L Turbo',
    transmission: 'DSG 7',
    drive: 'FWD',
    fuel: 'Gasolina',
    wikiTitle: 'Volkswagen_Golf_GTI',
    image: FALLBACK_IMAGE,
  },
  {
    id: 37,
    make: 'Honda',
    model: 'Civic Type R',
    year: 2023,
    price: 'R$ 430.000',
    engine: '2.0L Turbo',
    transmission: 'Manual 6',
    drive: 'FWD',
    fuel: 'Gasolina',
    wikiTitle: 'Honda_Civic_Type_R',
    image: FALLBACK_IMAGE,
  },
  {
    id: 38,
    make: 'Toyota',
    model: 'GR Yaris',
    year: 2023,
    price: 'R$ 380.000',
    engine: '1.6L Turbo',
    transmission: 'Manual 6',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Toyota_GR_Yaris',
    image: FALLBACK_IMAGE,
  },
  {
    id: 39,
    make: 'Mini',
    model: 'Cooper JCW',
    year: 2024,
    price: 'R$ 320.000',
    engine: '2.0L Turbo',
    transmission: 'Auto 8',
    drive: 'FWD',
    fuel: 'Gasolina',
    wikiTitle: 'Mini_John_Cooper_Works',
    image: FALLBACK_IMAGE,
  },
  {
    id: 40,
    make: 'Renault',
    model: 'Megane RS',
    year: 2022,
    price: 'R$ 290.000',
    engine: '1.8L Turbo',
    transmission: 'EDC 6',
    drive: 'FWD',
    fuel: 'Gasolina',
    wikiTitle: 'Renault_Megane_RS',
    image: FALLBACK_IMAGE,
  },
  {
    id: 41,
    make: 'Mercedes',
    model: 'A45 AMG',
    year: 2023,
    price: 'R$ 550.000',
    engine: '2.0L Turbo',
    transmission: 'DCT 8',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Mercedes-AMG_A45',
    image: FALLBACK_IMAGE,
  },
  {
    id: 42,
    make: 'Audi',
    model: 'RS3',
    year: 2023,
    price: 'R$ 580.000',
    engine: '2.5L I5',
    transmission: 'S-Tronic',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Audi_RS3',
    image: FALLBACK_IMAGE,
  },
  {
    id: 43,
    make: 'Mazda',
    model: 'MX-5 Miata',
    year: 2023,
    price: 'R$ 220.000',
    engine: '2.0L I4',
    transmission: 'Manual 6',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Mazda_MX-5',
    image: FALLBACK_IMAGE,
  },
  {
    id: 44,
    make: 'Subaru',
    model: 'WRX STI',
    year: 2021,
    price: 'R$ 300.000',
    engine: '2.5L Boxer',
    transmission: 'Manual 6',
    drive: 'AWD',
    fuel: 'Gasolina',
    wikiTitle: 'Subaru_WRX',
    image: FALLBACK_IMAGE,
  },
  {
    id: 45,
    make: 'Fiat',
    model: '500e',
    year: 2024,
    price: 'R$ 220.000',
    engine: 'Elétrico',
    transmission: 'Direct',
    drive: 'FWD',
    fuel: 'Elétrico',
    wikiTitle: 'Fiat_500e',
    image: FALLBACK_IMAGE,
  },
  {
    id: 46,
    make: 'Peugeot',
    model: 'e-208 GT',
    year: 2024,
    price: 'R$ 240.000',
    engine: 'Elétrico',
    transmission: 'Direct',
    drive: 'FWD',
    fuel: 'Elétrico',
    wikiTitle: 'Peugeot_208',
    image: FALLBACK_IMAGE,
  },
  {
    id: 47,
    make: 'Lexus',
    model: 'LC 500',
    year: 2023,
    price: 'R$ 1.100.000',
    engine: '5.0L V8',
    transmission: 'Auto 10',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Lexus_LC',
    image: FALLBACK_IMAGE,
  },
  {
    id: 48,
    make: 'Aston Martin',
    model: 'DB11',
    year: 2023,
    price: 'R$ 3.100.000',
    engine: '5.2L V12',
    transmission: 'Auto 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Aston_Martin_DB11',
    image: FALLBACK_IMAGE,
  },
  {
    id: 49,
    make: 'Maserati',
    model: 'MC20',
    year: 2023,
    price: 'R$ 4.500.000',
    engine: '3.0L V6',
    transmission: 'DCT 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Maserati_MC20',
    image: FALLBACK_IMAGE,
  },
  {
    id: 50,
    make: 'Ferrari',
    model: 'Roma',
    year: 2023,
    price: 'R$ 3.300.000',
    engine: '3.9L V8',
    transmission: 'DCT 8',
    drive: 'RWD',
    fuel: 'Gasolina',
    wikiTitle: 'Ferrari_Roma',
    image: FALLBACK_IMAGE,
  },
];

// Exponha e permita hidratar as imagens (chame isso no bootstrap do app)
window.carDatabase = carDatabase;
window.hydrateCarImages = hydrateCarImages;

// Se quiser já carregar automaticamente ao importar este arquivo, descomente:
// hydrateCarImages(window.carDatabase);
